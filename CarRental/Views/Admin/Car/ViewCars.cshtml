@model IEnumerable<CarRental.DTOs.CarDTO>




@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
<link rel="stylesheet" href="~/css/ViewCar.css" />

@* @if (TempData["SuccessMessage"] != null)
{
    <div id="success-alert" class="alert alert-success alert-dismissible fade show fade-custom" role="alert">
        <i class="fas fa-check-circle me-2"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
} *@
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@{
    ViewData["Title"] = "View Cars";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
@{
    int counter = 1;
}

@if (TempData["ShowAddCarModal"] != null && (bool)TempData["ShowAddCarModal"])
{
    <script>
        window.onload = function () {
            var addCarModal = new bootstrap.Modal(document.getElementById("AddCar"));
            addCarModal.show();
        };
    </script>
}



<h2>Car List</h2>
<a asp-action="AddCar" class="btn btn-primary mb-3">Add Car</a>
<table class="table table-striped">
    <thead>
        <tr>
            <th>No</th>
            <th>Car Name</th>
            <th>Brand</th>
            <th>Color</th>
            <th>Ratings</th>
            <th>Rental Rate</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var car in Model)
        {
            <tr>
                <td>@counter</td>
                <td>@car.CarName</td>
                <td>@car.BrandName</td>
                <td>@car.Color</td>
                <td>@car.Ratings</td>
                <td>@car.RentalRate.ToString("C")</td>  <!-- formatted as currency -->
                <td>
                    <a asp-action="UpdateCar" asp-route-id="@car.CarID" class="btn btn-sm btn-warning">
                        <i class="bi bi-pencil-fill"></i>
           
                    </a>
                   <form asp-action="DeleteCar" asp-controller="Admin" method="post"
                          onsubmit="return confirm('Are you sure you want to delete this car?');"
                          style="display:inline;">
                        <input type="hidden" name="id" value="@car.CarID" />
                        <button type="submit" class="btn btn-danger btn-sm">
                            <i class="bi bi-trash"></i>
                        </button>
                    </form>

                    <div id="images-container-@car.CarID" class="d-none">
                        @foreach (var img in car.ImageDataList)
                        {
                            <img src="@img" class="img-thumbnail" style="max-width:150px; max-height:150px;" />
                        }
                    </div>

                    <button 
                        type="button" 
                        class="btn btn-sm btn-success view-images-btn"
                        data-bs-toggle="modal"
                        data-bs-target="#carImagesModal"
                        data-carname="@car.CarName"
                        data-carid="@car.CarID">
                        <i class="bi bi-image-fill"></i>
                    </button>



                    @* <a asp-action="DeleteCar" asp-route-id="@car.CarID" class="btn btn-sm btn-danger">
                        <i class="bi bi-trash3-fill"></i>
                    </a> *@

                    <button type="button"
                            class="btn btn-sm btn-secondary view-units-btn"
                            data-bs-toggle="modal"
                            data-bs-target="#carUnitsModal"
                            data-carname="@car.CarName"
                            data-carid="@car.CarID">
                        <i class="bi bi-puzzle-fill"></i>
                    </button>                    
                  
                </td>
            </tr>
            counter++;

        }
    </tbody>

</table>
<link rel="stylesheet" href="~/css/imageForm.css" />

<!-- Combined Modal -->
<div class="modal fade" id="carImagesModal" tabindex="-1" aria-labelledby="carImagesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <!-- modal-lg for more space -->
        <div class="modal-content rounded-4 shadow-lg border-0">

            <div class="modal-header">
                <h5 class="modal-title" id="carImagesModalLabel">Car Images</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body bg-white">
                <!-- Display car name -->
                <h5 id="carNameModal" class="mb-3"></h5>

                <!-- Existing Images Container -->
                <div id="carImagesContainer" class="mb-4 d-flex flex-wrap gap-2">
                    <!-- Images will be injected here -->
                </div>

                <hr>

                <!-- Upload form -->
                <h6>Upload New Images</h6>
                <form asp-action="AddImage" asp-controller="Admin" method="post" enctype="multipart/form-data" id="imageUploadForm">
                    <input type="hidden" name="CarID" id="ImageCarID" />

                    <div class="mb-3">
                        <label for="ImageFiles" class="form-label">Select Image(s)</label>
                        <input type="file" name="ImageFiles" id="ImageFiles" class="form-control" multiple required />
                    </div>

                    <button type="submit" class="btn btn-primary w-100 mt-3">Upload</button>
                </form>
            </div>

        </div>
    </div>
</div>

<link rel="stylesheet" href="~/css/imageForm.css" />

<!-- Units Modal -->
<div class="modal fade" id="carUnitsModal" tabindex="-1" aria-labelledby="carUnitsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4 shadow-lg border-0">

            <div class="modal-header">
                <h5 class="modal-title" id="carUnitsModalLabel">Manage Units (Plate Numbers)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body bg-white">
                <!-- Display car name -->
                <h5 id="carNameUnitsModal" class="mb-3"></h5>

                <!-- Existing Units List -->
                <ul id="carUnitsList" class="list-group mb-3">
                    <!-- Plate numbers will be loaded here -->
                </ul>

                <!-- Add New Unit Form -->
                <form id="addUnitForm" onsubmit="return false;">
                    <input type="hidden" name="CarID" id="UnitCarID" />

                    <div class="mb-3">
                        <label for="newPlateNumber" class="form-label">Add New Plate Number</label>
                        <input type="text" id="newPlateNumber" class="form-control" placeholder="Enter new plate number" required />
                    </div>

                    <button type="submit" id="addUnitButton" class="btn btn-success w-100">Add Unit</button>
                </form>
            </div>

        </div>
    </div>
</div>


@section Scripts {

        <partial name="_ValidationScriptsPartial" />
        <script src="~/js/ImageForm.js"></script>
        <script src="~/js/ViewCar.js"></script>

}




