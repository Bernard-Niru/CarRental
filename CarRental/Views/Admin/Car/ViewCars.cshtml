@model IEnumerable<CarRental.DTOs.CarDTO>
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@{
    ViewData["Title"] = "View Cars";
}
@{
    int counter = 1;
}

<h2>Car List</h2>

<table class="table table-striped">
    <thead>
        <tr>
            <th>No</th>
            <th>Car Name</th>
            <th>Brand</th>
            <th>Color</th>
            <th>Ratings</th>
            <th>Rental Rate</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var car in Model)
        {
            <tr> 
                <td>@counter</td>
                <td>@car.CarName</td>
                <td>@car.BrandName</td>
                <td>@car.Color</td>            
                <td>@car.Ratings</td>
                <td>@car.RentalRate.ToString("C")</td>  <!-- formatted as currency -->
                <td>
                    <a asp-action="" asp-route-id="@car.CarID" class="btn btn-sm btn-warning">
                        <i class="bi bi-pencil-fill"></i>
                    </a>

                    <a asp-action="" asp-route-id="@car.CarID" class="btn btn-sm btn-danger">
                        <i class="bi bi-trash3-fill"></i>
                    </a>
                    <button type="button" class="btn btn-sm btn-success openImageModal" data-car-id="@car.CarID">
                        <i class="bi bi-image-fill"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-info openPlateModal" data-car-id="@car.CarID">
                        <i class="bi bi-card-text"></i>
                    </button>

                </td>
            </tr>
            counter++;
        
        }
    </tbody>
</table>


<link rel="stylesheet" href="~/css/imageForm.css" />

<!-- Image Upload Modal -->
<div class="modal fade" id="AddImageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <h4 class="mb-3">Add Car Images</h4>

            <form asp-action="AddImage" asp-controller="Admin" method="post" enctype="multipart/form-data">
                <!-- This binds to AddImageViewModel.CarID -->
                <input type="hidden" id="imageCarId" name="CarID" />

                <div id="imageContainer" class="mb-3">
                    <!-- Input will be inserted by JS -->
                </div>

                <button type="button" class="btn btn-outline-success btn-sm mb-2" id="addImageBtn">+ Add Image Input</button>
                <button type="submit" class="btn btn-primary">Upload Images</button>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const imageContainer = document.getElementById("imageContainer");
        const addImageBtn = document.getElementById("addImageBtn");

        document.querySelectorAll(".openImageModal").forEach(button => {
            button.addEventListener("click", function () {
                const carId = this.dataset.carId;
                document.getElementById("imageCarId").value = carId;

                // Reset inputs
                imageContainer.innerHTML = "";
                addImageInput();

                new bootstrap.Modal(document.getElementById("AddImageModal")).show();
            });
        });

        function addImageInput() {
            const wrapper = document.createElement("div");
            wrapper.classList.add("input-group", "mb-2");

            wrapper.innerHTML = `
                    <!-- ✅ Correct name for binding to AddImageViewModel.ImageFiles -->
                    <input name="ImageFiles" type="file" class="form-control" multiple required />
                `;

            // Only allow one input (since "multiple" is supported)
            imageContainer.innerHTML = "";
            imageContainer.appendChild(wrapper);
        }

        addImageBtn.addEventListener("click", addImageInput);
    });
</script>



@* <!-- Image Upload Modal -->
<div class="modal fade" id="AddImageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <h4 class="mb-3">Add Car Images</h4>

            <form asp-action="AddImage" asp-controller="Admin" method="post" enctype="multipart/form-data">
                <input type="hidden" id="imageCarId" name="CarID" />

                <div id="imageContainer" class="mb-3">
                    <!-- Input will be inserted by JS -->
                </div>

                <button type="button" class="btn btn-outline-success btn-sm mb-2" id="addImageBtn">+ Add Image Input</button>
                <button type="submit" class="btn btn-primary">Upload Images</button>
            </form>

        </div>
    </div>
</div>




<!-- Plate Number Modal -->
<div class="modal fade" id="AddPlateModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <h4 class="mb-3">Add Plate Numbers</h4>

            <form asp-action="AddUnit" asp-controller="Admin" method="post" id="plateForm">
                <input type="hidden" id="plateCarId" name="Units[0].CarID" />
                <div id="plateContainer"></div>

                <button type="button" class="btn btn-outline-primary btn-sm mb-2" id="addPlateBtn">+ Add Plate</button>
                <button type="submit" class="btn btn-primary">Save Plates</button>
            </form>
        </div>
    </div>
</div>





<script>
    document.addEventListener("DOMContentLoaded", function () {
        const plateContainer = document.getElementById("plateContainer");
        const addPlateBtn = document.getElementById("addPlateBtn");

        document.querySelectorAll(".openPlateModal").forEach(button => {
            button.addEventListener("click", function () {
                const carId = this.dataset.carId;
                document.getElementById("plateCarId").value = carId;

                plateContainer.innerHTML = "";
                addPlateInput();

                new bootstrap.Modal(document.getElementById("AddPlateModal")).show();
            });
        });

        function addPlateInput() {
            const index = plateContainer.querySelectorAll("input").length;
            const wrapper = document.createElement("div");
            wrapper.classList.add("input-group", "mb-2");

            wrapper.innerHTML = `
                    <input name="Units[0].PlateNumbers[${index}]" class="form-control" placeholder="Plate Number" required />
                    <button type="button" class="btn btn-danger btn-sm remove-plate">Remove</button>
                `;

            wrapper.querySelector(".remove-plate").addEventListener("click", () => {
                wrapper.remove();
                reindexPlateInputs();
            });

            plateContainer.appendChild(wrapper);
        }

        function reindexPlateInputs() {
            plateContainer.querySelectorAll("input").forEach((input, idx) => {
                input.name = `Units[0].PlateNumbers[${idx}]`;
            });
        }

        addPlateBtn.addEventListener("click", addPlateInput);
    });


    document.addEventListener("DOMContentLoaded", function () {
        const imageContainer = document.getElementById("imageContainer");
        const addImageBtn = document.getElementById("addImageBtn");

        document.querySelectorAll(".openImageModal").forEach(button => {
            button.addEventListener("click", function () {
                const carId = this.dataset.carId;
                document.getElementById("imageCarId").value = carId;

                imageContainer.innerHTML = "";
                addImageInput();

                new bootstrap.Modal(document.getElementById("AddImageModal")).show();
            });
        });

      function addImageInput() {
            const wrapper = document.createElement("div");
            wrapper.classList.add("input-group", "mb-2");

            wrapper.innerHTML = `
                    <input name="Units[0].ImageFiles" type="file" class="form-control" multiple required />
                    <button type="button" class="btn btn-danger btn-sm remove-image">Remove</button>
                `;

            wrapper.querySelector(".remove-image").addEventListener("click", () => {
                wrapper.remove();
            });

            imageContainer.appendChild(wrapper);
        } 
            function addImageInput() {
                const wrapper = document.createElement("div");
                wrapper.classList.add("input-group", "mb-2");

                wrapper.innerHTML = `
               <input name="ImageFiles" type="file" class="form-control" multiple required />

        `;

                // Prevent adding multiple inputs, only allow one with `multiple`
                imageContainer.innerHTML = ""; // Clear existing inputs
                imageContainer.appendChild(wrapper);
            }

        addImageBtn.addEventListener("click", addImageInput);
    });
</script>
 *@
