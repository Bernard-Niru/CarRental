@model CarRental.ViewModels.UnitSelectionViewModel

<form method="post" id="selectPlateForm" onsubmit="submitPlateSelection(event)">
    <div class="mb-3">
        <label asp-for="Unit" class="form-label"></label>
        <select asp-for="Unit" class="form-select stylish-input" asp-items="ViewBag.Unit" required>
            <option value="">-- Select Plate Number --</option>
        </select>
    </div>

    <input asp-for="RequestId" type="hidden" />
    <input asp-for="PlateNumber" type="hidden" id="PlateNumber" />

    <button type="submit" class="btn btn-primary w-100">Confirm</button>
</form>

<script>
    function submitPlateSelection(event) {
        event.preventDefault();

        const form = document.getElementById('selectPlateForm');
        const unitSelect = form.querySelector('select[name="Unit"]');
        const plateNumberInput = form.querySelector('input[name="PlateNumber"]');

        if (!unitSelect || unitSelect.selectedIndex <= 0) {
            alert('Please select a plate number');
            return;
        }

        // Set the hidden PlateNumber input to selected option's text
        plateNumberInput.value = unitSelect.options[unitSelect.selectedIndex].text;

        const data = new FormData(form);

        // Debug: log form data entries (optional, remove in production)
        for (const pair of data.entries()) {
            console.log(pair[0] + ': ' + pair[1]);
        }

        fetch('/Request/Numberplat', {
            method: 'POST',
            body: data
        })
            .then(res => {
                if (!res.ok) throw new Error('Network response was not ok');
                return res.json();
            })
            .then(result => {
                if (result.success) {
                    alert('Request accepted successfully!');
                    if (typeof closeModal === 'function') closeModal();
                    location.reload();
                } else {
                    alert('Error: ' + (result.message || 'Unknown error'));
                }
            })
            .catch(err => {
                alert('Error accepting request');
                console.error(err);
            });
    }
</script>
