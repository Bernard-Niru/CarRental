@model IEnumerable<CarRental.DTOs.RequestDTO>

@{
    int counter = 1;
}
@{
    ViewData["Title"] = "Requests";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2 class="text-center mb-4">Requests</h2>

<div class="table-responsive rounded-3 overflow-hidden shadow-sm">
    <table class="table table-hover table-striped align-middle">
        <thead class="table-dark">
            <tr>
                <th >No</th>
                <th>Username</th>
                <th >Car Name</th>
                <th>Pickup</th>
                <th>Return</th>
                <th >Accept / Reject</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var req in Model)
            {
                <tr>
                    <td>@counter</td>
                    <td>@req.Username</td>
                    <td>@req.CarName</td>
                    <td>
                        <span class=" d-block">@req.PickupDate.ToString("yyyy-MM-dd")</span>
                        <small class="text-muted">@req.PickupTime.ToString("hh:mm tt")</small>

                    </td>
                    <td>
                        <span class=" d-block">@req.ReturnDate.ToString("yyyy-MM-dd")</span>
                        <small class="text-muted">@req.ReturnTime.ToString("hh:mm tt")</small>
                    </td>
                    <td>


                        <a asp-action="AcceptRequest" asp-route-id="@req.RequestID" asp-route-CarID="@req.CarID" asp-route-UserID="@req.UserID" class="btn btn-sm btn-success me-3">
                          <i class="bi bi-check-lg"></i>Accept
                        </a>

                        <a asp-action="RejectRequest" asp-route-id="@req.RequestID" asp-route-CarID="@req.CarID" asp-route-UserID="@req.UserID" class="btn btn-sm btn-danger">
                                                  <i class="bi bi-x-lg"></i>                        
                        </a>

                      @*   <button class="btn btn-success" onclick="openPlateModal('@req.CarID', '@req.RequestID')">Accept</button>

                        <a asp-action="Numberplat" asp-route-id="@req.CarID" class="btn btn-sm btn-danger">  </a> *@


                    </td>
                </tr>
                counter++; 
            }
        </tbody>
    </table>
</div>
@* !-- Modal -->
<div id="unitModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modal-body"></div>
    </div>
</div>

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background: white;
        padding: 20px;
        margin: 10% auto;
        width: 400px;
        border-radius: 5px;
        position: relative;
    }

    .close {
        position: absolute;
        right: 10px;
        top: 10px;
        font-size: 20px;
        cursor: pointer;
    }
</style>

<script>
    function openPlateModal(carId, requestId) {
        console.log("carId:", carId, "requestId:", requestId);
        fetch(`/Admin/Numberplat?carId=${carId}&requestId=${requestId}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById("modal-body").innerHTML = html;
                document.getElementById("unitModal").style.display = "block";
            });
    }


    function closeModal() {
        document.getElementById("unitModal").style.display = "none";
        document.getElementById("modal-body").innerHTML = "";
    }

    window.onclick = function (event) {
        const modal = document.getElementById("unitModal");
        if (event.target === modal) closeModal();
    };
</script> *@

